@model FlowerShop.PRODUCT
@using FlowerShop.Helper
@using System.Globalization
@using FlowerShop.Carts;

@{
    ViewBag.Title = "Thông tin sản phẩm : "+Model.Product_Name;
    Helper helper = new Helper();
    string impPath = helper.getImageByProductID(Model.Product_ID);
    int cer = (int)Model.Product_Price;
    string cers = cer.ToString("C0", CultureInfo.CurrentCulture);
    List<string> listImg = helper.getListImageByProductID(Model.Product_ID);
    List<Cart> listCart = (List<Cart>)Session["Cart"];
    var Customers = Session["Customers"] as CUSTOMER;
}

<h5>Chi tiết sản phẩm</h5>

<div>
    <hr />
    <div class="row" style="margin: 6%;">
        <div class="col-md-12 d-flex">
            <div class="col-md-5">
                <div class="card" style="width: 100%;">
                    <img src="@impPath" class="card-img-top" alt="...">
                    <hr />
                    <div class="card-body">
                        <div class="row d-flex justify-content-center">
                            <h5 class="card-title">Mã sản phẩm : @Model.Product_ID</h5>
                        </div>
                        <hr />
                        <div class="row d-flex justify-content-center">
                            <b class="card-text">@cers VNĐ</b>
                        </div>
                        <hr />
                        <div class="row d-flex justify-content-center">
                            @{ bool check = false;
                                if (listCart != null)
                                {
                                    foreach (var cart in listCart)
                                    {
                                        if (cart.Product.Product_ID == Model.Product_ID)
                                        {
                                            check = true;
                                            break;
                                        }
                                    }
                                }
                                if (check)
                                {
                                    <div id="add-cart-btn-@Model.Product_ID"><button class="btn btn-outline-secondary" style="margin-left: 15px;" disabled>Đã thêm và giỏ hàng</button></div>
                                }
                                else
                                {
                                    if ((Customers != null) && (Customers.Customers_Name.CompareTo("Admin") == 0))
                                    {

                                    }
                                    else
                                    {
                                        <input id="add-cart-ip-@Model.Product_ID" type="number" value="1" min="1" max="@Model.Product_Stock_Quantity" style="text-align :center;border-radius : 5px" />
                                        <div id="add-cart-btn-@Model.Product_ID"><button id="@Model.Product_ID" productName="@Model.Product_Name" class="btn btn-primary add-to-cart" style="margin-left: 15px;">Thêm vào giỏ hàng</button></div>
                                    }
                                }
                            }
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-7">
                <h5><i class="fas fa-box-open"></i>&nbsp;@Model.Product_Name</h5>
                <hr />
                <i class="fas fa-info-circle"></i>&nbsp;@Model.Product_Description
                <hr />
                <div class="alert alert-success" role="alert">
                    <i class="fas fa-store"></i>&nbsp; Số lượng còn : @Model.Product_Stock_Quantity
                </div>
                <hr />
                <div id="carouselExampleControls" class="carousel slide" data-ride="carousel">
                    <div class="carousel-inner">
                        @if (listImg.Count > 0)
                        {
                            <div class="carousel-item active">
                                <img src="@listImg[0]" class="d-block w-100" alt="...">
                            </div>
                            for (int i = 1; i < listImg.Count; i++)
                            {
                                <div class="carousel-item">
                                    <img src="@listImg[i]" class="d-block w-100" alt="...">
                                </div>
                            }
                        }
                    </div>
                    <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                    </a>
                    <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
<script>
    function updateCountCart() {
        $.ajax({
        type: "GET",
        url: "@Url.Action("getCountOfCart", "Cart")",
        data: {},
        contentType: "application/json; charset=utf-8",
        dataType: "json",
        success: function (response) {
            alert(response);
        },
        failure: function (response) {
            alert(response.responseText);
        },
        error: function (response) {
            alert(response.responseText);
        }
        });
    };
    function updateCountCurCart() {
        $.ajax({
        type: "GET",
        url: "@Url.Action("getCountCurOfCart", "Cart")",
        data: {},
        contentType: "application/json; charset=utf-8",
        dataType: "json",
        success: function (response) {
            alert(response);
        },
        failure: function (response) {
            alert(response.responseText);
        },
        error: function (response) {
            alert(response.responseText);
        }
        });
    };
    $(document).ready(function () {
       updateCountCart();
       updateCountCurCart();
    });
    $(".add-to-cart").click(function (e) {
    var productID = $(this).attr("id");
        var productName = $(this).attr("productName");
         var amount = $("#add-cart-ip-" + productID).val();
    var r = confirm("Thêm sản phẩm : "+productName +" vào giỏ hàng ?");
    if (r == true) {
        $.ajax({
            type: "GET",
            url: "@Url.Action("AddNewCartItems", "Cart")",
            data: { amount : amount,productID : productID },
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (response) {
                alert(response);
                $("#add-cart-btn-"+productID).html("<button class='btn btn-outline-secondary' style='margin-left: 15px;' disabled>Đã thêm vào giỏ hàng</button>");
                updateCountCart();
                updateCountCurCart();
            },
            failure: function (response) {
                alert(response.responseText);
                $("#add-cart-btn-"+productID).html("<button class='btn btn-outline-secondary' style='margin-left: 15px;' disabled>Đã thêm vào giỏ hàng</button>");
                updateCountCart();
                updateCountCurCart();
            },
            error: function (response) {
                alert(response.responseText);
                $("#add-cart-btn-"+productID).html("<button class='btn btn-outline-secondary' style='margin-left: 15px;' disabled>Đã thêm vào giỏ hàng</button>");
                updateCountCart();
                updateCountCurCart();
            }
        });
    }
});
</script>
<div>
    <a href="@Url.Action("Index", "Home")"><i class="fas fa-home"></i> &nbsp; Về trang chủ !</a>
</div>
